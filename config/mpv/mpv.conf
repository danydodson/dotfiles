#  mpv - mpv.conf

############
# Playback #
############

[default]
# force-seekable=yes                       # Make all files seekable
# merge-files=yes                          # Merge multiple input files into a single timeline
reset-on-next-file=audio-delay,mute,pause,speed,sub-delay,video-aspect-override,video-pan-x,video-pan-y,video-rotate,video-zoom,volume # Resets these options to defaults when moving to next file
resume-playback=yes                      # Remembers and resumes file from last played position
save-position-on-quit=yes                # Saves playback position on quit for resuming
use-filedir-conf=no                      # Disables loading additional conf files from the file's dir
write-filename-in-watch-later-config=no  # Disables saving filename in watch-later resume files
user-agent=""Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Chrome/137.0.0.0 Safari/605.1.15"  # Customizes the HTTP user-agent string for online streams

script-opts-append=ytdl_hook-thumbnails=best                           # Directs ytdl_hook to fetch best available thumbnails
ytdl-raw-options-append=config-location=~/.dotfiles/config/yt/yt.conf  # Points youtube-dl options to use custom config
ytdl-raw-options-append=sub-lang=th,en,en-orig                         # Sets desired subtitle languages for youtube-dl based scripts

######
# UI #
######

# [builtin-pseudo-gui]
# terminal=no
# force-window=yes
# idle=once
# screenshot-directory=~/Desktop/

# [pseudo-gui]
# player-operation-mode=pseudo-gui

[ww-window-default]
autofit=50%x50%                           # Initial window scaled to 50% of display size
autofit-larger=50%x50%                    # Max window size set to 50%
geometry=50%:50%                          # Centers window in the middle of the screen

[ww-window-wide]
profile-desc="WW - Window - Wide"         # Description string for profile
profile-cond=((get("dwidth", 0) > get("dheight", 0)) and ((get("video-out-params/rotate", 0) % 180) == 0))  # Activates if video is landscape
autofit=100%x50%                          # Window fits full width, half height
geometry=100%:100%                        # Window at 0,0, to fill screen

[ww-window-tall]
profile-desc="WW - Window - Tall"         # Description string for profile
profile-cond=(not ((get("dwidth", 0) > get("dheight", 0)) and ((get("video-out-params/rotate", 0) % 180) == 0))) # Activates for portrait/rotated files
autofit=50%x100%                          # Half width, full height
geometry=100%:100%                        # Window at 0,0, to fill screen

[default]
profile=ww-window-default                 # Inherits ww-window-default window settings
background-color="#000000"              # Use black background for video window
cursor-autohide-fs-only=no                # Hide cursor only in fullscreen
cursor-autohide=100                       # Hide cursor after 100 ms of inactivity
force-window=no                           # Don’t force window if audio only
idle=yes                                  # Stay open when nothing loaded
input-doubleclick-time=200                # 200ms for detecting double-click
input-right-alt-gr=no                     # Don’t use AltGr key for input
keep-open-pause=no                        # Don’t pause when video ends
keep-open=yes                             # Window stays open on file end
macos-fs-animation-duration=0             # No animation when entering fullscreen
macos-title-bar-appearance=darkAqua       # Use DarkAqua look for title bar
macos-title-bar-material=fullScreen       # Use fullscreen material for title
msg-level=all=warn                        # Show warnings and errors only in log/output
native-fs=no                              # Don’t use native OS fullscreen
native-keyrepeat=yes                      # Enable native key repeat
# ... remainder auto follows from above ...

[ww-ui-audio-display]
profile-desc="WW - UI - Audio"            # Description for profile
profile-cond=( ({aac=true, ac3=true, aiff=true, alac=true, dts=true, eac3=true, flac=true, m4a=true, mka=true, mp3=true, ogg=true, opus=true, thd=true, wav=true, wma=true, wv=true})[get("filename", ""):lower():match("^.+%.(.+)$")] or false) # If file extension is audio, apply this profile
profile-restore=copy                      # Restore settings on profile switch
background-color="#181818"              # Use dark gray window background
force-window=yes                          # Always open window even for audio
geometry=1280x720-0-0                     # Open window at specified size and position
script-opts-append=osc-visibility=always  # Always show OSD controller

[ww-ui-image-display]
profile-desc="WW - UI - Images"           # Description for profile
profile-cond=( ({mf=true})[get("file-format", "")] or ({avif=true, bmp=true, gif=true, jpeg=true, jpg=true, jxl=true, png=true, tif=true, tiff=true, webp=true})[get("filename", ""):lower():match("^.+%.(.+)$")] or false ) # Activate only on image formats
profile-restore=copy                      # Restore profile settings
profile=ww-video-max                      # Use max video quality for images
background=color                          # Set background for image viewing
background-color="#000000"              # Background color black
audio-file-auto=no                        # Disable auto audio for images
sub-auto=no                               # Disable auto-subs for images
image-display-duration=inf                # Display image infinitely until user closes
loop-file=inf                             # Loop single image infinitely
loop-playlist=inf                         # Loop image playlist infinitely
video-aspect-override=no                  # Do not override aspect ratio for images
video-sync=audio                          # Synchronize video to audio (has no effect for images)

#######
# OSD #
#######

[default]
osc=no                             # Disables default On Screen Controller; uses custom script
load-stats-overlay=no              # Disables default stats overlay; uses custom script

osd-level=1                        # Basic OSD info
osd-on-seek=msg-bar                # Show seek message bar

osd-bar=no                         # Disables classical OSD progress bar
osd-bar-align-y=1                  # OSD bar bottom aligned
osd-bar-border-size=0              # No border for OSD bar
osd-bar-h=1.5                      # Height of OSD bar
osd-bar-w=100                      # Width of OSD bar

osd-align-y=top                    # Align OSD to top
osd-duration=1500                  # Show OSD for 1.5c seconds
osd-margin-x=20                    # Horizontal margin for OSD
osd-margin-y=16                    # Vertical margin for OSD
osd-shadow-color="#00000000"     # Transparent text shadow

osd-font="SFProRounded-Regular"    # Font for OSD
osd-font-size=14                   # Font size for OSD
osd-color="#D0FFFFFF"            # OSD text color (semi-transparent white)
osd-border-color="#E0000000"     # OSD border color (transparent black)
osd-border-size=1.6                # OSD border thickness
osd-blur=0.3                       # Slight blur for OSD
osd-spacing=0.2                    # Space between OSD lines

##############
# Screenshot #
##############

[default]
sws-fast=no                               # Use accurate (not fast) software scaler
sws-scaler=spline                         # Spline as screenshot scaler
sws-allow-zimg=yes                        # Allow using zimg high quality scaler
zimg-fast=no                              # Use high quality zimg
zimg-scaler=spline36                      # Use spline36 filter in zimg
zimg-scaler-chroma=spline36               # Use spline36 for chroma scaling in zimg
screenshot-format=png                     # Save screenshots as PNG (lossless)
screenshot-tag-colorspace=yes             # Tag colorspace in screenshot metadata
screenshot-png-compression=8              # Use PNG compression 8 (higher is smaller, slower)
screenshot-template="%F - %wH-%wM-%wS"    # Screenshot naming template: filename and wall time

#############################
# Cache & Demuxer & Decoder #
#############################

[ww-cache-low]
profile-desc="WW - Cache - Local"         # Description for local cache
cache-pause=no                            # Don’t pause when buffering
cache-pause-initial=no                    # Don’t pause for initial buffer fill
cache-secs=12                             # Cache 12 seconds ahead
stream-buffer-size=1MiB                   # 1MiB buffer for streaming
demuxer-lavf-buffersize=1048576           # 1 MiB demuxer buffer size
demuxer-max-bytes=48MiB                   # Max 48MiB in demuxer RAM
demuxer-max-back-bytes=16MiB              # Allow seeking 16MiB before cached start
demuxer-hysteresis-secs=2                 # Keep cache open for 2 more seconds past buffer

[ww-cache-high]
profile-desc="WW - Cache - Remote"        # Description of remote cache
profile-cond=( get("demuxer-via-network", false) )  # Use when reading from network
profile-restore=copy                      # Restore settings when switching back
cache-pause=yes                           # Pause when buffering
cache-pause-initial=yes                   # Pause on initial buffer fill
cache-pause-wait=10                       # Wait 10s before resuming
stream-buffer-size=4MiB                   # 4MiB buffer for streaming
demuxer-lavf-buffersize=4194304           # 4 MiB demuxer buffer
demuxer-max-bytes=384MiB                  # Demuxer RAM max for network: 384 MiB
demuxer-max-back-bytes=128MiB             # Seek back up to 128MiB behind in network files
demuxer-hysteresis-secs=0                 # Don’t extend cache past playhead

[default]
profile=ww-cache-low                              # Use local cache config by default
cache=yes                                         # Enable cache
demuxer-lavf-analyzeduration=10                   # Probe input stream for 10 seconds to detect format
demuxer-lavf-probesize=10000000                   # Probe up to 10MB for stream info
demuxer-lavf-o=max_reload=10                      # Allow 10 retries for network errors
demuxer-mkv-subtitle-preroll=yes                  # Preload subtitles when seeking in MKV files
demuxer-mkv-subtitle-preroll-secs=4               # Preroll 4s before current position for subs
demuxer-mkv-subtitle-preroll-secs-index=8         # For indexes, preroll 8s
network-timeout=15                                # 15s until giving up on network connections
stream-lavf-o-append=multiple_requests=1          # Allow parallel network requests
stream-lavf-o-append=reconnect_delay_max=3        # Max 3s between reconnect attempts
stream-lavf-o-append=reconnect_on_http_error=1    # Reconnect on HTTP error
stream-lavf-o-append=reconnect_on_network_error=1 # Reconnect on network error

ad-lavc-threads=2          # Audio decoding: 2 threads
ad-queue-enable=yes        # Enable audio decode queue
ad-queue-max-bytes=32MiB   # Audio decode queue max RAM: 32MiB
ad-queue-max-samples=6000  # Audio decode buffer can hold 6000 samples
ad-queue-max-secs=0        # (0 means unused)

vd-lavc-threads=0          # Video decoding: auto thread count (0)
vd-queue-enable=yes        # Enable video decode queue
vd-queue-max-bytes=96MiB   # Video decode queue RAM: 96MiB
vd-queue-max-samples=3     # Video decode queue samples: 3
vd-queue-max-secs=0        # (0 means unused)

#############
# Subtitles #
#############

[ww-subtitle-english]
profile-desc="WW - Subtitle Style - Language - English"
sub-codepage=auto                               # Automatically detect subtitle encoding
sub-font="SFProRounded-Regular"                  # Font for English subtitles
sub-font-size=40                                # Font size for subs
sub-line-spacing=16                             # Extra space between subtitle lines

[ww-subtitle-thai]
profile-desc="WW - Subtitle Style - Language - Thai"
profile-cond=( (({th=true, tha=true, thai=true})[get('current-tracks/sub/lang', ''):lower()] ~= nil) ) # Activate for Thai language
profile-restore=copy                            # Restore previous profile
sub-codepage=auto                               # Auto encoding
sub-font="SFProRounded-Regular"                 # Font for Thai subs
sub-font-size=60                                # Large font for Thai
sub-line-spacing=12                             # Line spacing for Thai

[ww-subtitle-other]
profile-desc="WW - Subtitle Style - Language - Other"
profile-cond=( (({en=true, eng=true, english=true, th=true, tha=true, thai=true, ['']=true})[get('current-tracks/sub/lang', ''):lower()] == nil) ) # Applies if sub is not EN or TH
profile-restore=copy
sub-codepage=auto
sub-font="SFProRounded-Regular"
sub-font-size=48
sub-line-spacing=14

[ww-subtitle-text]                              # Section: Text subtitle settings
profile-desc="WW - Subtitle Style - Type - Text"
blend-subtitles=no                              # Subs drawn separately from video

[ww-subtitle-bitmap]                            # Section: Bitmap subtitle settings (PGS, DVD, DVB)
profile-desc="WW - Subtitle Style - Type - Bitmap"
profile-cond=( (({dvb_subtitle=true, dvd_subtitle=true, hdmv_pgs_subtitle=true})[get('current-tracks/sub/codec', ''):lower()] ~= nil) )
profile-restore=copy
blend-subtitles=video                           # Subs bitmapped onto video frames

[default]                                       # Section: Subtitle defaults
profile=ww-subtitle-english,ww-subtitle-text    # English text subs by default
sub-color="#D0FFFFFF"                         # Subtitle color: semi-transparent white
sub-border-color="#E0000000"                  # Subtitle border color: transparent black
sub-border-size=2.4                             # Border thickness
sub-blur=0.3                                    # Subtitle blur
sub-fix-timing=no                               # Do not auto-fix subtitle timing
sub-gauss=0.6                                   # Gaussian blur for rendering
sub-gray=yes                                    # Gray out partial subs
sub-justify=left                                # Left-justified subtitles
sub-margin-y=14                                 # Margin from screen bottom
sub-scale=0.75                                  # Relative scaling for subtitles
sub-filter-sdh=yes                              # Filter out hearing-impaired text
sub-filter-sdh-harder=yes                       # Stronger filtering for SDH
sub-filter-regex-append=opensubtitles\.org      # Sub filter for opensubtitles.org style lines
sub-ass-force-margins=yes                       # Ensure ASS/SSA margins are honored
sub-ass-style-overrides=Kerning=yes             # Enable kerning in ASS/SSA subs
sub-ass-override=force                          # Force override existing ASS styles

##################
# Audio Profiles #
##################

[default]
ad-lavc-downmix=no                           # Don’t downmix surround to stereo
audio-channels=quad,stereo                   # Prefer 4-channel audio, then stereo
volume=40                                    # Default volume: 40%
volume-max=200                               # Max volume: 200%

### Resampling ###
audio-resample-cutoff=0.96                   # 96% cutoff for upsampling audio
audio-resample-linear=yes                    # Use linear interpolation during resampling

# SWR only
audio-resample-filter-size=32                # Filter size for SWResample
audio-resample-phase-shift=12                # Phase shift for SWResample

# SOXR only
audio-swresample-o-append=cheby=0            # Disable Cheby filter for SOXR
audio-swresample-o-append=dither_method=shibata
audio-swresample-o-append=precision=33       # Enable high precision in SOXR

### Resampling Profiles ###

[ww-audio-resample-no]                        # Section: No resampling
profile-desc="WW - Audio - Resample - No"
audio-samplerate=0                           # Don't alter source sample rate
audio-swresample-o-append=resampler=swr      # Use swr for resampling

[ww-audio-resample-44]
profile-desc="WW - Audio - Resample - SOXR 44KHz"
audio-format=float
audio-samplerate=44100
audio-swresample-o-append=resampler=soxr

[ww-audio-resample-48]
profile-desc="WW - Audio - Resample - SOXR 48KHz"
audio-format=float
audio-samplerate=48000
audio-swresample-o-append=resampler=soxr

[ww-audio-resample-96]
profile-desc="WW - Audio - Resample - SOXR 96KHz"
audio-format=float
audio-samplerate=96000
audio-swresample-o-append=resampler=soxr

##################
# Video Profiles #
##################

# Scaler Comparison: https://artoriuz.github.io/blog/mpv_upscaling.html

# Built-in Profiles (mpv --show-profile=high-quality):

# [fast]
# scale=bilinear                                # Fastest, low quality upscaling
# cscale=(scale)                                # Input color scaling matches luma upscaler
# dscale=bilinear                               # Downscale: bilinear filter
# dither=no                                     # No dither
# correct-downscaling=no                        # No advanced downscaling correction
# linear-downscaling=no                         # Don’t use linear filter for downscaling
# sigmoid-upscaling=no                          # No sigmoid for upscaling
# hdr-compute-peak=no                           # Don’t compute HDR peaks
# allow-delayed-peak-detect=yes                 # Allow delayed peak detection for HDR

# [default] (implicit mpv defaults)
# scale=lanczos
# cscale=(scale)
# dscale=hermite
# deband=no
# dither-depth=auto
# correct-downscaling=yes
# linear-downscaling=yes
# sigmoid-upscaling=yes
# hdr-compute-peak=yes

# [high-quality] (inherits default options)
# scale=ewa_lanczossharp
# cscale=(scale)
# hdr-peak-percentile=99.995
# hdr-contrast-recovery=0.30

# [mpv-gpu-default]
# profile-desc="MPV - Video - Defaults (Copied)"
# scale=lanczos
# cscale=lanczos
# dscale=hermite
# deband=yes #
# dither-depth=no #
# correct-downscaling=yes
# linear-downscaling=yes
# sigmoid-upscaling=yes
# hdr-compute-peak=no  # Unsupported on macOS

# [ww-video-low]
# profile-desc="WW - Video - High Performance"
# profile=fast
# deband-iterations=1
# cscale=bilinear
# script-opts-append=Shaders-enabled=no

# [ww-video-mid]
# profile-desc="WW - Video - Mid Quality"
# profile=mpv-gpu-default
# deband-iterations=2
# dscale=lanczos
# script-opts-append=Shaders-enabled=no

# [ww-video-high-quality]
# profile-desc="WW - Video - Base High Quality"
# profile=ww-video-mid,high-quality
# deband-iterations=3
# scale=ewa_lanczos4sharpest
# cscale=ewa_lanczos4sharpest
# dscale=lanczos

# [ww-video-high]
# profile-desc="WW - Video - High Quality"
# profile=ww-video-high-quality
# script-opts-append=Shaders-enabled=no

# [ww-video-max]
# profile-desc="WW - Video - Max Quality"
# profile=ww-video-high-quality
# script-opts-append=Shaders-enabled=yes

### Video - Defaults

[default]
profile=ww-video-mid
hwdec-extra-frames=8
macos-force-dedicated-gpu=yes
macos-render-timer=feedback
swapchain-depth=8
vulkan-queue-count=8
video-sync=display-resample
video-sync-max-video-change=10
background=none
deband-grain=0
icc-3dlut-size=129x129x129
icc-profile-auto=yes
interpolation=no
sigmoid-center=0.6666667
sigmoid-slope=9.5
temporal-dither=yes
tscale-window=sphinx
tscale=catmull_rom
scale-antiring=0.8
dscale-antiring=0.8
cscale-antiring=0.8

### Video - OS Specifics

# [ww-video-win]
# profile-desc="WW - Video - OS Settings - Windows"
# ao=auto
# vo=auto
# hwdec=auto-copy-safe

# [ww-video-nix]
# profile-desc="WW - Video - OS Settings - *nix"
# ao=auto
# vo=auto
# hwdec=auto-copy-safe

# [ww-video-mac-gl]
# profile-desc="WW - Video - OS Settings - Mac libmpv"
# ao=coreaudio
# vo=libmpv
# gpu-api=auto
# gpu-context=auto
# hwdec=videotoolbox-copy

# [ww-video-mac-vk]
# profile-desc="WW - Video - OS Settings - Mac Vulkan"
# #ao=avfoundation
# ao=coreaudio
# vo=gpu-next
# gpu-api=vulkan
# gpu-context=macvk
# hwdec=videotoolbox-copy

#####################
# Hardware Profiles #
#####################

# [ww-win]
# profile-desc="WW - OS Settings - Windows"
# profile=ww-audio-resample-no,ww-video-mid,ww-video-win

# [ww-nix]
# profile-desc="WW - OS Settings - *nix"
# profile=ww-audio-resample-no,ww-video-mid,ww-video-nix

# [ww-mac]
# profile-desc="WW - OS Settings - Mac"
# profile=ww-audio-resample-96,ww-video-mid,ww-video-mac-gl
# ytdl-raw-options-append=format-sort=height:2160

# [ww-mbp-2009]
# profile-desc="WW - Host Settings - Macbook Pro 2009"
# profile=ww-audio-resample-no,ww-video-low,ww-video-mac-gl
# script-opts-append=osc-barmargin=39
# script-opts-append=Thumbnailer-auto_gen=no
# script-opts-append=Thumbnailer-auto_show=no
# ytdl-raw-options-append=format-sort=height:800

# [ww-mbp-2012]
# profile-desc="WW - Host Settings - Macbook Pro 2012"
# profile=ww-audio-resample-96,ww-video-high,ww-video-mac-gl
# script-opts-append=osc-barmargin=39
# ytdl-raw-options-append=format-sort=height:1440

# [ww-mini]
# profile-desc="WW - Host Settings - Mini 2021"
# profile=ww-audio-resample-96,ww-video-max,ww-video-mac-vk
# script-opts-append=osc-barmargin=39
# ytdl-raw-options-append=format-sort=height:2160

# [ww-plex-mid]
# profile-desc="WW - Plex Settings - Mid Quality"
# profile=ww-audio-resample-no,ww-video-mid,ww-video-mac

# [ww-plex-high]
# profile-desc="WW - Plex Settings - High Quality"
# profile=ww-audio-resample-no,ww-video-high,ww-video-mac

[default]
# profile=ww-mac
# profile=ww-mbp-2009
# profile=ww-mbp-2012
# profile=ww-mbp-2012
# profile=ww-mini
# profile=ww-plex-mid
# profile=ww-plex-high

################
# Logs & Paths #
################

[default]
log-file="~/Library/Logs/mpv.log"  # File for general logs
screenshot-dir="~/Pictures/"       # Default screenshot folder
osd-fonts-dir="~/Library/fonts"   # OSD font path
sub-fonts-dir="~/Library/fonts"   # Subtitle font path

demuxer-cache-dir="/Users/Shared/Library/Caches/mpv/demuxer/"    # Demuxer cache storage location
gpu-shader-cache-dir="/Users/Shared/Library/Caches/mpv/gpu/"     # GPU shader cache storage location
icc-cache-dir="/Users/Shared/Library/Caches/mpv/gpu/"            # ICC profile cache storage
watch-later-dir="/Users/Shared/Library/Caches/mpv/watch-later/"  # Storage for "watch later" resume states
